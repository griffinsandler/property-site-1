<!DOCTYPE html>
<html>
     <%= render '/layouts/tenant_nav_bar' %>
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <script src="https://www.paypalobjects.com/api/checkout.js"></script>
    </head>
    <body>
        <script>
            paypal.Button.render({
            env: 'production', // Or 'sandbox',

            commit: true, // Show a 'Pay Now' button

              style: {
                color: 'gold',
                size: 'small'
              },

      payment: function(data, actions) {
          
        /* 
         * Set up the payment here 
         */
      },

      onAuthorize: function(data, actions) {
        /* 
         * Execute the payment here 
         */
      },

      onCancel: function(data, actions) {
        /* 
         * Buyer cancelled the payment 
         */
      },

      onError: function(err) {
        /* 
         * An error occurred during the transaction 
         */
      }
    }, '#paypal-button');
  </script>
        <br/>
        <div class = "row">
            <div class = "col s6">
                <div class = "card orange darken-4">
                    <span class = "card-title white-text" style = "padding:5px;">My Info</span>
                    <div class = "card-content black-text white">
                        <p>
                            <ul>
                                <li><b>Name:</b> <%= @tenant.name%></li>
                                <li><b>Email:</b> <%= @tenant.email%></li>
                                <li><b>Phone Number:</b> <%= @tenant.phone_number%></li>
                                <%if @property %>
                                    <li><b>My Property:</b> <a class "waves-effect waves-teal btn-flat" href="<%= properties_path %>/<%= @property.id %>"><%= @property.name %> </a> </td>
                                    <li><b>Monthly Rent:</b> <%= @tenant.rentNum %></td>
                                <% else %>
                                    <li><b>My Property:</b> None</li>
                                <% end %>
                            </ul>
                        </p>
                    </div>
                    <div class = "card-action">
                        <a href = "/tenants/edit" class = "white-text">Edit</a>
                    </div>
                </div>
            </div>
        <% if not @roommates.nil? %>
            <% if not @roommates.empty? %>
                <div class = "col s6">
                    <div class = "card orange darken-4">
                        <span class = "card-title white-text" style = "padding:5px;">My Housemates</span>
                        <div class = "card-content black-text white">
                            <table class = "highlight"  >
                                <thead>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone Number</th>
                                    <th>Monthly Rent</th>
                                </thead>
                                <tbody>
                                    <% @roommates.each do |t| %>
                                        <tr>
                                            <td><%= t.name %></td>
                                            <td><%= t.email %></td>
                                            <td><%= t.phone_number %></td>
                                            <td><%= t.rentNum %></td>
                                        </tr>
                                    <% end %>
                                 </tbody>
                            </table>
                            <% if @roommateRentTot < @property.monthly_rent %> 
                                <span class = "red-text"><i class="material-icons left">warning</i> Your monthly rent is <%= @property.monthly_rent %>, but you have agreed to pay <%=@roommateRentTot%> in total.
                                <br/>Please adjust your monthly rent contributions.
                                </span>
                            <% end %>
                        </div>
                    </div>
                </div>
            <% end %>
        <% end %>
        <% if not @services.nil? %>
            <% if not @services.empty? %>
                <div class = "col s6">
                    <div class = "card orange darken-4">
                        <span class = "card-title white-text" style = "padding:5px;">Service Requests</span>
                        <div class = "card-content black-text white">
                            <table class = "highlight"  >
                                <thead>
                                    <th>Address</th>
                                    <th>Subject</th>
                                </thead>
                                <tbody>
                                    <% @services.each do |t| %>
                                        <tr>
                                            <td>  <a class "waves-effect waves-teal btn-flat" href="<%= services_path %>/<%= t.id %>"><%= t.address %> </a> </td>
                                            <td><%= t.subject %> </td>
                                        </tr>
                                    <% end %>
                                 </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            <% end %>
        <% end %>
        </div>
        <div class = "row">
            <div class = "col s6">
                <div class = "card orange darken-4">
                    <span class = "card-title white-text" style = "padding:5px;"> Rent</span>
                    <div class = "card-content black-text white">
                        <table class = "highlight"  >
                        <thead>
                            <th>Address</th>
                            <th>Amount Due</th>
                            <th>Total Due</th>
                            <th>Pay</th>
                            <th></th>
                        </thead>
                        <tbody>
                            <%if @property %>
                                    <% @tenant.rent.each do |r| %>
                                       <tr>
                                            <td><%= @property.address %> </a> </td>
                                            <% if @tenant.rentNum.nil? %>
                                                <td><a href = "/tenants/edit">Edit</a></td>
                                            <% else %>
                                                <td><%= @tenant.rentNum %> </td>
                                                <td><%= r.total %> </td>
                                                <td><div id = "paypal-button"/></td>
                                                <td><a class "waves-effect waves-teal btn-flat" href="/tenants/pay/<%= r.id %>">Pay Rent</a></td>
                                            <% end %>
                                        </tr>
                                    <% end %>
                                </tr>
                            <% end %>
                        </tbody>
                    </table>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
    </body>
</html>